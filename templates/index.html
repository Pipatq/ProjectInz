<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Information & Billing System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <h1 class="no-print">Patient &amp; Billing System</h1>

    <div class="main-container no-print">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="openTab('patientTab')">1. Patient &amp; Billing</button>
            <button class="tab-button" onclick="openTab('productsTab')">2. Products</button>
            <button class="tab-button" onclick="openTab('receiptTab')">3. Receipt</button>
            <button class="tab-button" onclick="loadTransactionHistory(); openTab('historyTab')">History</button>
        </div>

        <!-- Tab 1: Patient & Billing Info -->
        <div id="patientTab" class="tab active">
            <div class="section">
                <h2>Patient & Procedure Information</h2>
                <div class="form-grid">
                    <div>
                        <label for="firstName">First Name:</label>
                        <input type="text" id="firstName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á" autofocus>
                    </div>
                    <div>
                        <label for="lastName">Last Name:</label>
                        <input type="text" id="lastName" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                    </div>
                    <div>
                        <label for="patientType">Patient Type:</label>
                        <select id="patientType">
                            <option value="OPD">OPD (Outpatient)</option>
                            <option value="IPD">IPD (Inpatient)</option>
                            <option value="ForeignOPD">Foreign OPD</option>
                            <option value="ForeignIPD">Foreign IPD</option>
                            <option value="Staff">Staff</option>
                        </select>
                    </div>
                    <div>
                        <label for="patientAge">Age (‡∏≠‡∏≤‡∏¢‡∏∏):</label>
                        <input type="number" id="patientAge" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 35">
                    </div>
                    <div>
                        <label for="doctorName">Doctor Name (‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏≠):</label>
                        <input type="text" id="doctorName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤">
                    </div>
                    <div>
                        <label for="consultant">Consultant (‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤):</label>
                        <input type="text" id="consultant" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤">
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <label for="procedureInfo">Procedure (‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£):</label>
                        <input type="text" id="procedureInfo" placeholder="‡πÄ‡∏ä‡πà‡∏ô Full Blepharoplasty, Mini Blepharoplasty">
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Billing & Payment</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0;">Payment Details</h3>
                    <button class="secondary" onclick="printDepositSlip()">üñ®Ô∏è Print Deposit Slip</button>
                </div>
                <div class="form-grid">
                     <div>
                        <label for="hospitalFee">Hospital Fee (‡∏Ñ‡πà‡∏≤‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•):</label>
                        <input type="number" id="hospitalFee" placeholder="0.00" value="0" oninput="updateBillingSummary()">
                    </div>
                    <div>
                        <label for="depositAmount">Deposit (‡∏°‡∏±‡∏î‡∏à‡∏≥):</label>
                        <input type="number" id="depositAmount" placeholder="0.00" value="0" oninput="updateBillingSummary()">
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <label>Payment Method (‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô):</label>
                        <div class="checkbox-group">
                            <input type="radio" id="payCash" name="paymentMethod" value="Cash" checked> <label for="payCash">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î (Cash)</label>
                            <input type="radio" id="payTransfer" name="paymentMethod" value="Transfer"> <label for="payTransfer">‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô (Transfer)</label>
                        </div>
                    </div>
                     <div style="grid-column: 1 / -1;">
                        <label>Review Status:</label>
                        <div class="checkbox-group">
                             <input type="checkbox" id="statusDeposit" name="reviewStatus" value="‡∏°‡∏±‡∏î‡∏à‡∏≥"> <label for="statusDeposit">‡∏°‡∏±‡∏î‡∏à‡∏≥</label>
                             <input type="checkbox" id="statusEye" name="reviewStatus" value="‡∏ó‡∏≥‡∏ï‡∏≤"> <label for="statusEye">‡∏ó‡∏≥‡∏ï‡∏≤</label>
                             <input type="checkbox" id="statusReview" name="reviewStatus" value="‡∏£‡∏µ‡∏ß‡∏¥‡∏ß"> <label for="statusReview">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</label>
                             <input type="checkbox" id="statusNoReview" name="reviewStatus" value="‡πÑ‡∏°‡πà‡∏£‡∏µ‡∏ß‡∏¥‡∏ß"> <label for="statusNoReview">‡πÑ‡∏°‡πà‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</label>
                        </div>
                    </div>
                     <div style="grid-column: 1 / -1;">
                        <label for="comment">Comment (‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏):</label>
                        <textarea id="comment" rows="3" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>
                    </div>
                </div>
            </div>
            
            <div id="billingSummary">
                <h4>Billing Summary (Preview)</h4>
                <p><span>Product Total (‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤):</span> <span id="summaryProductTotal">0.00 ‡∏ø</span></p>
                <p><span>+ Hospital Fee (‡∏Ñ‡πà‡∏≤ ‡∏£‡∏û.):</span> <span id="summaryHospitalFee">0.00 ‡∏ø</span></p>
                <hr>
                <p><strong><span>Grand Total (‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î):</span> <span id="summaryGrandTotal">0.00 ‡∏ø</span></strong></p>
                <p><span>- Deposit (‡∏°‡∏±‡∏î‡∏à‡∏≥):</span> <span id="summaryDeposit">0.00 ‡∏ø</span></p>
                <hr>
                <p><strong><span>Outstanding Balance (‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞):</span> <span id="summaryOutstanding">0.00 ‡∏ø</span></strong></p>
            </div>

            <div style="text-align: right; margin-top: 20px;">
                <button onclick="savePatientInfoAndProceed()">Save &amp; Continue ‚Üí</button>
            </div>
        </div>

        <!-- Tab 2: Products -->
        <div id="productsTab" class="tab">
            <button class="back" onclick="openTab('patientTab')">‚Üê Back to Patient Info</button>
            <h2>Product Selection</h2>
             <div class="search-container" style="margin-top: 20px;">
                <div class="quick-search-buttons">
                    <button class="quick-search-btn" onclick="quickSearch('IV')">IV</button>
                    <button class="quick-search-btn" onclick="quickSearch('Syringe')">Syringe</button>
                    <button class="quick-search-btn" onclick="quickSearch('Gauze')">Gauze</button>
                    <button class="quick-search-btn" onclick="quickSearch('Alcohol')">Alcohol</button>
                    <button class="quick-search-btn" onclick="quickSearch('‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à')">‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à</button>
                </div>
                <div class="search-input-container">
                    <input type="text" id="searchProduct" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™..." oninput="searchProducts()" autocomplete="off">
                    <button class="clear-search" onclick="clearSearch()">√ó</button>
                </div>
                <div id="searchResults" style="border: 1px solid #ddd; max-height: 200px; overflow-y: auto; margin-top: 5px;"></div>
            </div>

            <div id="cart">
                <h3>Shopping Cart</h3>
                <table id="cartTable">
                    <thead><tr><th>Product</th><th>Price</th><th>Qty</th><th>Total</th><th>Action</th></tr></thead>
                    <tbody id="cartItems"></tbody>
                    <tfoot>
                        <tr>
                            <td colspan="3" style="text-align: right;"><strong>Product Total:</strong></td>
                            <td id="cartTotal">0.00</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
             <div style="text-align: right; margin-top: 20px;">
                <button onclick="generateReceipt()">Generate Receipt ‚Üí</button>
            </div>
        </div>
        
        <!-- Tab 3: Receipt -->
        <div id="receiptTab" class="tab">
            <button class="back no-print" onclick="openTab('productsTab')">‚Üê Back to Products</button>
            
            <div class="receipt-preview-container">
                <!-- This content is populated by JS -->
            </div>

            <div class="no-print" style="margin-top: 30px; text-align: right;">
                <button onclick="printMainReceipt()">üñ®Ô∏è Print Full Receipt</button>
                <button class="back" onclick="resetFlow()">New Patient</button>
            </div>
        </div>

        <!-- Tab 4: History -->
        <div id="historyTab" class="tab">
             <h2>Transaction History</h2>
            <input type="text" id="historySearch" placeholder="Search by patient name, doctor, or date..." oninput="searchHistory()" style="width: 100%; margin-bottom: 20px;">
            <div id="historyResults"><p>Loading history...</p></div>
        </div>
    </div>

    <!-- Hidden Printable Templates -->
    <div id="receipt" class="print-area">
        <h2>‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô / Receipt</h2>
        <hr>
        <p><strong>Receipt ID:</strong> <span data-field="receiptId"></span> | <strong>Date:</strong> <span data-field="receiptDate"></span></p>

        <div class="receipt-grid">
            <div>
                <h4>Patient Details</h4>
                <p><strong>Name:</strong> <span data-field="receiptName"></span></p>
                <p><strong>Age:</strong> <span data-field="receiptAge"></span></p>
                <p><strong>Type:</strong> <span data-field="receiptType"></span></p>
            </div>
            <div>
                <h4>Procedure Details</h4>
                <p><strong>Doctor:</strong> <span data-field="receiptDoctor"></span></p>
                <p><strong>Consultant:</strong> <span data-field="receiptConsultant"></span></p>
                <p><strong>Procedure:</strong> <span data-field="receiptProcedure"></span></p>
            </div>
        </div>

        <h3>Items &amp; Charges</h3>
        <table id="receiptItemsTable_print">
            <thead><tr><th>Product</th><th>Price</th><th>Qty</th><th>Total</th></tr></thead>
            <tbody></tbody>
        </table>

        <table class="receipt-summary-table">
            <tbody>
                <tr><td>Product Total:</td><td><span data-field="receiptSubtotal">0.00</span> ‡∏ø</td></tr>
                <tr><td>Hospital Fee:</td><td><span data-field="receiptHospitalFee">0.00</span> ‡∏ø</td></tr>
                <tr style="font-weight: bold; border-top: 1px solid #333; border-bottom: 1px solid #333;"><td>Grand Total:</td><td><span data-field="receiptGrandTotal">0.00</span> ‡∏ø</td></tr>
                <tr><td>Deposit Paid:</td><td><span data-field="receiptDeposit">0.00</span> ‡∏ø</td></tr>
                <tr style="font-weight: bold; font-size: 1.1em; color: #c0392b;"><td>Outstanding:</td><td><span data-field="receiptOutstanding">0.00</span> ‡∏ø</td></tr>
            </tbody>
        </table>
        <p data-hide-on-screen="true"><strong>Payment Method:</strong> <span data-field="receiptPaymentMethod"></span></p>
        <p data-hide-on-screen="true"><strong>Review Status:</strong> <span data-field="receiptReviewStatus"></span></p>
        <p data-hide-on-screen="true"><strong>Comment:</strong> <span data-field="comment"></span></p>
    </div>

    <div id="depositSlip" class="print-area">
        <h2>‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ / Deposit Receipt</h2>
        <hr>
        <p><strong>Date:</strong> <span data-field="depositDate"></span></p>
        <p><strong>Patient Name:</strong> <span data-field="depositName"></span></p>
        <p><strong>Procedure:</strong> <span data-field="depositProcedure"></span></p>
        <br>
        <p style="font-size: 1.2em;"><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ (Deposit Amount):</strong></p>
        <p style="font-size: 1.5em; text-align: center; border: 1px solid black; padding: 10px; margin-top: 10px;">
            <span data-field="depositAmount">0.00</span> ‡∏ø
        </p>
        <br><br>
        <p>.........................................</p>
        <p>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô (Receiver)</p>
    </div>
    
    <script src="static/app.js"></script>
</body>
</html>
